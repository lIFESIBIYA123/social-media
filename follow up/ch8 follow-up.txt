Creating the UI

The REST API is ready to accept requests and list the API. For the next steps, ensure that the Django 
server is running on the machine at port localhost:8000. The first step is implementing a post 
feed with a ready design and UI. Before coding the components for reading, creating, updating, and 
deleting a component, we need to analyze the UI and also make sure we have the right configurations 
and components to ease the development with React. We will mostly build the navigation bar and 
the layout.

---------------------------------------------
Adding the NavBar component

The NavBar will have three links:
• A link to redirect to the feed page (1)
• A link to redirect to the profile page (2)
• A link to log out (3)

---------------------------------------------
src/components/Navbar.jsx

import React from "react";
import { randomAvatar } from "../utils";
import { Navbar, Container, Image, NavDropdown, Nav } from "react-bootstrap";
import { useNavgate } from "react-router-dom";

function Navigationbar() {
    return (
        <Navbar bg="primary" variant="dark">
            <Container>
                <Navbar.Brand className="fw-bold" href="#home">
                    Autocrat Tech
                </Navbar.Brand>
                <Navbar.Collapse className="justify-content-end">
                    <Nav>
                        <NavDropdown
                            title={
                                <Image
                                    src={randomAvatar()}
                                    roundedCircle
                                    width={36}
                                    height={36}
                                />
                            }
                        >
                            <NavDropdrown.Item href="#">
                                profile
                            </NavDropdown.Item>
                            <NavDropdown.Item onClick={handleLogout}>
                                Logout
                            </NavDropdown.Item>
                        </NavDropdown>
                    </Nav>
                </Navbar.Collapse>
            </Container>
        </Navbar>
    );

}

export default Navigationbar;

---------------------------------------------
Let’s add the function that handles the logout:

function Navigationbar() {
    const navigate = useNavigate();
    const handleLogout = () => {
        localStorage.removeItem("auth");
        navigate("/login");
    };
}
---------------------------------------------
In the src directory, add a new file called utils.js. This file will contain functions that 
we’ll reuse in the React application:

src/utils.js

export const randomAvatar = () => 
    `https://i.pratvatar.cc/300?img=${math.floor(math.random()* 60) + 1}`;
---------------------------------------------

The pravatar service supports parameters in the URL and has over 60 images. We are using 
the Math library to generate a random number representing the image’s ID. We can now write the 
Layout component.
---------------------------------------------
Adding the Layout component

src/components/Layout.jsx

import React from "react";
import Navigationbar from "./Navbar";

function Layout(props) {
    return (
        <div>
            <Navigationbar />
            <div className="container m-5">{props.children}</div>
        </div>
    );
}

export default Layout;
---------------------------------------------
Using the Layout component on the home page
src/pages/Home.jsx

import React from "react";
import { getUser } from "../hooks/user.actions";
import Layout from "../components/Layout";

function Home() {
  const user = getUser();

  if (!user) {
    return <div>Loading!</div>;
  }

  return (
    <Layout>
      
    </Layout>
  );
}

export default Home;
---------------------------------------------

Creating a post

To create and add posts, follow these steps:
1. In src/components, add a new directory called posts. This directory will contain all 
components used for the post feature. We’ll have components to create a post, display a post, 
and update a post.
2. Inside the newly created directory, add a file called CreatePost.jsx. This file will contain 
the code for the logic and the UI to make a post.
3. What we have here is a UI component called Modal. react-bootstrap provides a modalready element that we can easily customize for our needs. Let’s start by adding the needed 
imports and defining the component function:
---------------------------------------------

src/components/post/CreatePost.jsx

import React, { useState } from "react";
import { Button, Modal, Form } from "react-bootstrap";
import axiosService from "../../helpers/axios";
import { getUser } from "../../hooks/user.actions";

function CreatePost() {
    const [show, setShow] = useState(false);
    const handleClose = () = setShow(false);
    const handleShow = () => setShow(true);

    return (
        <>
            <Form.Group className="my-3 w-75">
                <Form.Conttrol className="py-2 rounded-pill border-primary text-primary"
                    type="text"
                    placeholder="write a post"
                    onClick={handleShow}
                />
            </Form.Group>
            {/* add mpdal code here */}
        </>
    );
}

export default CreatePost;
---------------------------------------------
We are first adding the input that will trigger the Modal to be displayed. A click on the modal 
will set the show state to True, the state that is used for opening the modal. Let’s add the 
code for the modal:
---------------------------------------------
src/components/post/CreatePost.jsx

import React, { useState } from "react";
import { Button, Modal, Form } from "react-bootstrap";
import axiosService from "../../helpers/axios";
import { getUser } from "../../hooks/user.actions";

function CreatePost() {
    const [show, setShow] = useState(false);
    const handleClose = () => setShow(false);
    const handleShow = () => setShow(true);

    return (
        <>
            <Form.Group className="my-3 w-75">
                <Form.Control className="py-2 rounded-pill border-primary text-primary"
                    type="text"
                    placeholder="write a post"
                    onClick={handleShow}
                />
            </Form.Group>
            {/* add modal code here */}

            <Modal show={show} onHide={handleClose}>
                <Modal.Header closeButton className="border-0">
                    <Modal.Title>Create Post</Modal.Title>
                </Modal.Header>

                <Modal.Body className="border-0">
                    <Form noValidate validated={validated}
                        onSubmit={handleSubmit}>
                        <Form.Group className="mb-3">
                            <Form.Control
                                name="body"
                                value="form.body"
                                onChange={(e) => setForm({ ...form, body:e.target.value})}
                                as="textarea"
                                rows={3}
                            />
                        </Form.Group>
                    </Form>
                </Modal.Body>

                <Modal.Footer>
                    <Button variant="primary"
                        onClick={handleSubmit}
                        disabled={form.body === undefined}
                    >
                        Post
                    </Button>
                </Modal.Footer>
            </Modal>
        </>
    );
}

export default CreatePost;
---------------------------------------------
The UI for the modal is created. We need now to add the handleSubmit function and the 
other logic for the form 
src/components/post/CreatePost.jsx

 {/**andleSubmit function and the other logic for the form handling */}

    const [validated, setValidated] = useState(false);
    const [form, setForm] = useState({});

    const user = get = getUser();

    const handleSubmit = (event) => {
        event.preventDefault();
        conts createPostForm = event.currentTarget;

        if (createPostForm.checkValidity() == false) {
            event.stopPropagation();
        }

        setValidated(true);

        const data = {
            author: user.id,
            body: form.body,
        };

        axiosService
            .post("/post/", data)
            .then(() => {
                handleClose();
                setForm({});
            })
            .catch((error) => {
                console.log(error);
            });
    };
---------------------------------------------

Adding the Toast component

Let’s quickly create a component called Toaster that we will use show toast in the React application.
In src/components, create a new file called Toaster.jsx. This file will contain the code for 
the Toaster component:
---------------------------------------------
src/components/Toaster.jsx

import React from "react";
import { Toast, ToastContainer } from "react-bootstrap";

function Toaster(props) {
    const { showToast, title, message, onClose, type } = props;

    return (
        <ToastContainer position="top-center">
            <Toast onClose={onClose} show={showToast} delay={3000} autohide bg={type}>
                <Toast.Header>
                    <strong className="me-auto">{title}</strong>
                </Toast.Header>
                <Toast.Body>
                    <p className="text-white">{message}</p>
                </Toast.Body>
            </Toast>
        </ToastContainer>
    );

}

export default Toaster;

---------------------------------------------
The Toaster component takes some props:
• showToast: The Boolean that is used to show the toast or not. Ideally, depending on the output 
we receive from a request on the server, we’ll set the state to true, which will show the toast.
• title: This represents the title of the toast.
• message: This conveys the message we’ll be showing in the toast.
• onClose: The function that handles the closing of the toast. This function is essential; otherwise, 
the toast will never disappear.
• type: This represents the type of toast to show. In our context, we’ll either use success
or danger.
Let’s import this component in CreatePost.jsx and use it.
---------------------------------------------

Adding toaster to post creation

In the CreatePost.jsx file, we will add new states that we will pass as props to the 
Toaster component:

src/components/post/CreatePost.jsx

import Toaster from "../Toaster";

+++++++++++++++++++++++++++++
function CreatePost() {
    const [show, setShow] = useState(false);
    const handleClose = () => setShow(false);
    const handleShow = () => setShow(true);

    {/**toaster */}
    const [showToast, setShowToast] = useState(false);
    const [toastMessage, setToastMessage] = useState("");
    const [toastType, setToastType] = useState("");

    {/**andleSubmit function and the other logic for the form handling */}

    const [validated, setValidated] = useState(false);
    const [form, setForm] = useState({});

    const user = getUser();

    const handleSubmit = (event) => {
        event.preventDefault();
        const createPostForm = event.currentTarget;

        if (createPostForm.checkValidity() === false) {
            event.stopPropagation();
        }

        setValidated(true);

        const data = {
            author: user.id,
            body: form.body,
        };

        axiosService
            .post("/post/", data)
            .then(() => {
                handleClose();
                setToastMessage("Post created");
                setToastType("success");
                setForm({});
                setShowToast(true);
            })
            .catch((error) => {
                setMessage("an error occured");
                setToasttype("danger");
                
            });
    };
+++++++++++++++++++++++++++++++

</Modal>

            <Toaster
                title="post!"
                message={toastMessage}
                showToast={showToast}
                type={toastType}
                onClose={() => setShowToast(false)}
            />
---------------------------------------------
_____________________________________________

Adding the CreatePost component to the home page
The CreatePost component is ready now, and we can use it. First, import it into the Home.jsx
file and modify the UI.
---------------------------------------------

We can achieve the result quickly by using rows and columns components provided by reactbootstrap. We won’t focus on the second part (listing the profiles) for the moment. Let’s ensure 
we have all CRUD operations for the post feature:

src/pages/Home.jsx

import React from "react";
import { Roe, Col, Image } from "react-boostrap";
import { randomAvatar } from "../utils";
import useSWR from "swr";
import { fetcher } "../helpers/axios";
import { getUser } from "../hooks/user.actions";
import Layout from "../components/Layout";

function Home() {
  const user = getUser();

  if (!user) {
    return <div>Loading!</div>;
  }

  return (
    <Layout>
      <Row className="justfy-content-evenly">
        <Col sm={7}>
          <Row className="border rounded align-items-center">
            <Col className="flex-shrin-1">
              <Image
                src={randomAvatar()}
                roundedCircle
                width={52}
                height={52}
                className="my-2"
              />

            </Col>
            <Col sm={10} className="flex-grow-1">
              <CreatePost />
            </Col>
          </Row>
        </Col>
      </Row>
    </Layout>
  );
}

export default Home;
---------------------------------------------

npm install swr
or
yarn add swr
What is SWR:
SWR (stale-while-revalidate) is a React Hooks library by Vercel for data 
fetching. It handles caching, revalidation, focus tracking, refetching on 
intervals, and more. SWR returns cached (stale) data immediately, 
then fetches fresh data (revalidate) in the background, updating the UI 
when complete. This provides fast, always-up-to-date user experiences 
with minimal code, automatic error handling, and optimized performance 
for remote data management.

npm install react-error-boundary
<ErrorBoundary>
  <YourComponent />
</ErrorBoundary>
---------------------------------------------
Listing posts on the home page

Here’s the flow to list the posts on the home page:
• We use the swr library to fetch a list of posts
• We loop through the list of posts and then pass a post as props to a component called Post, 
which will show data about a post
---------------------------------------------

Writing the Post component
1. Inside the src/components/post/ directory, create a new file called Post.jsx. This 
file will contain the logic to show post data and logic such as like or remove like, deletion, and 
modification. Here’s a wireframe of the Post component:

2. To make things faster, we will work with the Card component provided by react-bootstrap. 
The Card component comes with a structure containing a title, body, and footer:

---------------------------------------------
src/components/post/Post.jsx
The post variable holds post data, while refresh updates the UI. 
handleLikeClick sends a like or unlike request via Axios and refreshes the post state after success.


import React, { useState } from "react";
import { format } from "timeago.js"
import {LikeField, CommentOutlined, LikedOutlined, } from "@ant-design/icon";
import { Image, Card, Dropdown } from "react-bootstrap";
import { randomAvatar } from "../../utils";

functionPost(props) {
    const { post, refresh } = props;

    const handleLikeClick = (action) => {
        axiosService
            .post(`/post/${post.id}/${action}/`)
            .then(() => {
                refresh();
            })
            .catch((err) => console.error(err));
    };

    return (
        <>
            <Card className="rounded-3 my-4">
                {/* add card body here */}
            </Card>
        </>
    );
}
a
export default Post;
---------------------------------------------
The Post component accepts two props:
 The post object containing data about a post.
 The refresh function. This function will come from the SWR posts object, and SWR 
returns an object with a mutate method that can be used to trigger the fetching of data.
---------------------------------------------
adding the Card body.
src/components/post/Post.jsx

import React, { useState } from "react";
import { format } from "timeago.js"
import { LikeFilled, CommentOutlined, LikedOutlined } from "@ant-design/icons";
import { Image, Card, Dropdown } from "react-bootstrap";
import { randomAvatar } from "../../utils";

function Post(props) {
    const { post, refresh } = props;

    const handleLikeClick = (action) => {
        axiosService
            .post(`/post/${post.id}/${action}/`)
            .then(() => {
                refresh();
            })
            .catch((err) => console.error(err));
    };

    return (
        <>
            <Card className="rounded-3 my-4">
                {/* add card body here */}
                <Card.Body>
                    <Card.Title className="d-flex flex-row justify-content-between">
                        <div className="d-flex flex-row">
                            <Image
                                src={randomAvatar()}
                                roundedCircle
                                width={48}
                                height={48}
                                className="me-2 border border-primary border-2"
                            />
                            <div className="d-flex flex-column justify-content-start align-self-center mt-2">
                                <p className="fs-6 m-0">
                                    {post.author.name}
                                </p>

                                <p className="fs-6 fw-lighter">
                                   <small>{format(post.created)}</small>
                                </p>
                            </div>
                        </div>
                    </Card.Title>
                    <Card.Text>{post.body}</Card.Text>
                    <div className="d-flex flex-row">
                        <LikeFilled
                            style={{
                                color: "#fff",
                                backgroundColor: "#0D6EFD",
                                borderRadius: "50%",
                                width: "18px",
                                height: "18px",
                                fontSize: "75%",
                                padding: "2px",
                                margin: "3px",
                            }}
                        />
                        <p className="ms-1 fs-6">
                            <small>{post.likes_count} like</small>
                        </p>
                    </div>
                </Card.Body>

                <Card.Footer className="d-flex bg-white w-50 justify-content-between border-0">
                    <div className="d-flex flex-row">
                        <LikedOutlined
                            style={{
                                width: "24px",
                                height: "24px",
                                padding: "2px",
                                fontSize: "20px",
                                color: post.liked ? "#0D6EFD": "#C4C4C4",
                            }}
                            onClick={() => {
                                if (post.liked) {
                                    handleLikeClick("remove_like");
                                } else {
                                    handleLikeClick("like");
                                }
                            }}
                        />
                        <p className="ms-1">
                            <small>Like</small>
                        </p>
                    </div>

                    {/* Add comment icon here*/}

                    <div className="d-flex flex-row">
                        <CommentOutlined
                            style={{
                                width: "24px",
                                height: "24px",
                                padding: "2px",
                                fontSize: "20px",
                                color: "#C4C4C4",
                            }}
                        />

                        <p className="ms-1 mb-0">
                            <small>Comment</small>
                        </p>
                    </div>
                </Card.Footer>
            </Card>
        </>
    );
}

export default Post;
---------------------------------------------
Adding the Post component to the home page
src/pages/Home.jsx

import { Post } from "../components/posts";

function Home() {
 const posts = useSWR("/post/", fetcher, {
 refreshInterval: 10000,
 });
...

The useSWR Hook can accept some parameters, such as refreshInterval. Here, the returned 
data is refreshed every 10 seconds. We can now use these objects in the UI:

src/pages/Home.jsx

import React from "react";
import Layout from "../components/Layout";
import { Row, Col, Image } from "react-bootstrap";
import { randomAvatar } from "../utils";
import useSWR from "swr";
import { fetcher } from "../helpers/axios";
import { getUser } from "../hooks/user.actions";
import { Post } from "../components/posts/Post";
import CreatePost from "../components/posts/CreatePost";

function Home() {
  const posts = useSWR("/post/", fetcher, {
    refreshInterval: 10000,
  });

  const user = getUser();

  if (!user) {
    return <div>Loading!</div>;
  }

  return (
    <Layout>
      <Row className="justify-content-evenly">
        <Col sm={7}>
          <Row className="border rounded  align-items-center">
            <Col className="flex-shrink-1">
              <Image
                src={randomAvatar()}
                roundedCircle
                width={52}
                height={52}
                className="my-2"
              />
            </Col>
            <Col sm={10} className="flex-grow-1">
              <CreatePost refresh={posts.mutate}/>
            </Col>
          </Row>
          <Row className="my-4">
            {posts.data?.results.map((post, index) => (
              <Post key={index} post={post} refresh={posts.mutate} />
            ))}
          </Row>
        </Col>
      </Row>
    </Layout>
  );
}

export default Home;
---------------------------------------------
src/components/post/Post.jsx

react-bootstrap provides a Dropdown component we can use to achieve the same result. In 
the Post.jsx file, import the Dropdown component from react-bootstrap. As we will add 
the logic for post deletion, let’s also import the Toaster component:

import { Button, Modal, Form, Dropdown } from "reactbootstrap";
import Toaster from "../Toaster";

 const MoreToggleIcon = React.forwardRef(({ onClick }, ref) => (
        <Link
            to="#"
            ref={ref}
            onClick={(e) => {
                e.preventDefault();
                onClick(e);
            }}
        >
            <MoreOutlined />
        </Link>
    ));


We can now add the Dropdown component to the UI. We need to make it conditional so that only 
the author of the post can access these options. We will just retrieve the user from localStorage
and compare user.id to author.id:

...
function Post(props) {
...
 const [showToast, setShowToast] = useState(false);
 const user = getUser();
...

const handleDelete = () => {
        axiosService
            .delete(`/post/${post.id}/`)
            .then(() => {
                setShowToast(True);
                refresh();
            })
            .catch((err) => console.error(err));
    };

...
Let’s add the component UI and the Toaster component:

</div>

                        {user.name === post.author.name && (
                            <div>
                                <Dropdown>
                                    <Dropdown.Toggle as={MoreToggleIcon}></Dropdown.Toggle>
                                    <Dropdown.Menu>
                                        <UpdatePost post={post} refresh={refresh} />
                                        <Dropdown.Item
                                            onClick={handleDelete}
                                            className="text-danger"
                                        >
                                            Delete
                                        </Dropdown.Item>
                                    </Dropdown.Menu>
                                </Dropdown>
                            </div>
                        )}
                    </Card.Title>

                    .................

            </Card>
            <Toaster 
                title="success!"
                massage="Post deleted"
                type="danger"
                showToast={showToast}
                onClick={() => setShowToast(false)}
            />
        </>
---------------------------------------------
